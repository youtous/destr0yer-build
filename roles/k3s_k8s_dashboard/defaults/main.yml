---
# k8s-dashboard variables

k8s_dashboard_chart_version: "7.0.3"
k8s_dashboard_chart_download_url: "https://kubernetes.github.io/dashboard/kubernetes-dashboard-{{ k8s_dashboard_chart_version }}.tgz"
k8s_dashboard_chart_sha265sum: "8f32f02b060b1e4d575cdf2ae120595b7a9397c6f90272ce444beff0b6bf9c1f"

k8s_dashboard_helm_release_name: kubernetes-dashboard

k8s_dashboard_k8s_namespace: kubernetes-dashboard

k8s_dashboard_k8s_helm_values:

  app:
    ingress:
      ingressClassName: haproxy

      annotations:
        # TODO : replace by allow-list when it will work, until use whitelist
        # ensure that at least one ip exists in the whitelist, otherwise all ips are allowed
        haproxy.org/whitelist: "{{ (trusted_backend_ips + ['127.0.0.1'] | flatten) | join(', ') }}"

        haproxy.org/load-balance: "roundrobin"

        # overrides defaults
        haproxy.org/response-set-header: >
          Content-Security-Policy \"default-src 'self'; script-src 'self'
           'unsafe-inline'; img-src 'self' data: 'self'; style-src 'self' 'unsafe-inline';
           font-src 'self' data:; frame-ancestors 'self'; frame-src 'self'; object-src 'none';\"

      # tls
      issuer:
        scope: cluster
        name: letsencrypt

      # TODO : document
      # One should enable this in production
      # secretName: "dashboard-kube-certmanager" # cert name for certmanager
      hosts:
        - "dashboard.{{ k8s_base_cluster_domain }}" # adapt to your needs

  nginx:
    enabled: false
  cert-manager:
    enabled: false
  metrics-server:
    enabled: false

k8s_dashboard_helm_show_commands: true

# kube config
k8s_dashboard_kubeconfig_path: "{{ ansible_env.HOME }}/.kube/config"
...

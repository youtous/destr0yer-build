---

## save rules across reboots
- name: Export DOCKER-USER ip6tables chain
  become: true
  ansible.builtin.shell: >
    set -o pipefail &&
    ip6tables -S DOCKER-USER
  register: ip6tables_docker_user_rules
  changed_when: false

- name: Save DOCKER-USER ip6tables rules
  become: true
  ansible.builtin.blockinfile:
    create: true
    dest: "/etc/iptables.docker-user.rules.v6"
    mode: u=rw,g=r,o=
    block: |
      *filter

      {{ ip6tables_docker_user_rules.stdout }}

      COMMIT
    marker: "### {mark} ANSIBLE MANAGED BLOCK - IPv6 DOCKER-USER before rules ###"
  when: ip6tables_docker_user_rules is not failed

...

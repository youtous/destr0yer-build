---
# This role install or update cilium if needed

- name: Check if cilium is installed
  ansible.builtin.stat:
    path: "{{ k8s_cilium_path }}"
  register: cilium_binary_present

- name: Get cilium installed version
  ansible.builtin.shell: >
    set -o pipefail &&
    {{ k8s_cilium_path }} version | grep "{{ k8s_cilium_cli_version_output }}" --only-matching
  args:
    executable: /bin/bash
  when: cilium_binary_present.stat.exists
  changed_when: false
  register: cilium_current_version

- name: Install cilium
  when: not cilium_binary_present.stat.exists or (cilium_current_version.stdout != k8s_cilium_cli_version_output)
  ansible.builtin.import_tasks: install.yml
...

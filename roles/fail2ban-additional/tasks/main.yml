---
# This role permits to append additional services to the fail2ban jail
# see https://github.com/Oefenweb/ansible-fail2ban for naming details
- name: Update fail2ban jail configuration with additional services
  become: yes
  template:
    src: files/additional-services.j2.conf
    dest: "/etc/fail2ban/jail.d/{{ service.name }}.conf"
    owner: root
    group: root
    mode: u=rw,g=,o=
  with_items: "{{ fail2ban_services }}"
  loop_control:
    loop_var: service
  notify:
    - restart fail2ban
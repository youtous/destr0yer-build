---
# This permits to append additional services to the fail2ban jail
# see https://github.com/Oefenweb/ansible-fail2ban for naming details
- name: Update fail2ban jail configuration with additional services
  become: true
  blockinfile:
    dest: "/etc/fail2ban/jail.local"
    block: "{{ lookup('template', 'files/additional-services.j2') }}"
    marker: "### {mark} ANSIBLE MANAGED BLOCK - configure {{ service.name }} jail ###"
  with_items: "{{ fail2ban_services }}"
  loop_control:
    loop_var: service
  notify:
    - restart fail2ban
---
# This role contains the default configuration for setting up Monit (a monitoring tool)
- name: Install Monit
  import_tasks: install.yml

- name: Setup Monit
  become: yes
  import_tasks: anxs.yml

- name: Setup additional Monit configurations
  become: yes
  template:
    src: "templates/etc/monit/conf.d/{{item}}.j2"
    dest: "/etc/monit/conf.d/{{item}}"
  with_items:
    - system
  notify:
    - reload monit

- name: Configure firewall to allow Monit on lo
  become: yes
  ufw:
    name: Monit
    rule: allow
    port: "2812"
    interface: lo
    direction: in

- name: Enable Monit
  become: yes
  service:
    name: monit
    enabled: yes

---
# This role contains the default configuration for setting up Monit (a monitoring tool)
- name: List mounted devices paths
  ansible.builtin.set_fact:
    mounted_devices_path: "{{ ansible_mounts | community.general.json_query('[].mount') }}"

- name: Install Monit
  ansible.builtin.import_tasks: install.yml

- name: Setup Monit
  become: true
  ansible.builtin.import_tasks: anxs.yml

- name: Setup additional Monit configurations
  become: true
  ansible.builtin.template:
    src: "templates/etc/monit/conf.d/{{ item }}.j2"
    dest: "/etc/monit/conf.d/{{ item }}"
    mode: u=rw,g=r,o=
  with_items:
    - system
  notify:
    - Reload monit

- name: Enable Monit
  become: true
  ansible.builtin.service:
    name: monit
    enabled: true
...

---
# see https://github.com/unxnn/ansible-users

- name: Add password to root user
  become: true
  user:
    name: root
    password: "{{ root_password }}"

- name: Remove default users if exist
  become: true
  user:
    name: "{{ item }}"
    state: absent
    remove: yes
  with_items:
    - debian

- name: Setup users
  become: true
  import_role:
    name: unxnn.users
  vars:
    # concatenate the common and the specific to host users list
    users: "{{ common_users | default([]) + host_users | default([]) }}"
    groups_to_create: "{{ common_groups_to_create | default([]) + host_groups_to_create | default([]) }}"

- name: Allow admin group sudo with password
  become: true
  lineinfile:
    path: /etc/sudoers
    state: present
    regexp: '^%admin ALL='
    line: '%admin ALL=(ALL) PASSWD: ALL'
    validate: '/usr/sbin/visudo -cf %s'
  tags: ["users", "groups", "configuration"]
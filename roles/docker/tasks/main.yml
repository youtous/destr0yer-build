---
# This role contains docker installation
- name: Install python docker module
  become: yes
  pip:
    executable: pip3  # because docker-ansible uses python2
    state: latest
    name: "docker-py"

- name: Ensure docker group is present
  become: yes
  group:
    gid: "{{ docker_group_gid }}"
    name: "{{ docker_group_name }}"

- name: Adding user '{{ ansible_user }}' to docker group
  become: yes
  block:
    - user:
        name: "{{ ansible_user }}"
        groups: "{{ docker_group_name }}"
        append: true
    - meta: reset_connection

- name: Setup docker
  become: yes
  import_role:
    name: geerlingguy.docker
  vars:
    docker_apt_arch: "{{ 'arm64' if (ansible_architecture == 'aarch64') else 'amd64' }}"
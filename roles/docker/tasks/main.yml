---
# This role contains docker installation
- name: Install python docker module
  become: true
  pip:
    state: latest
    name: docker

- name: Ensure docker group is present
  become: true
  group:
    gid: "{{ docker_group_gid }}"
    name: "{{ docker_group_name }}"

- name: Adding user '{{ ansible_user }}' to docker group
  become: true
  user:
    name: "{{ ansible_user }}"
    groups: "{{ docker_group_name }}"
    append: true
  register: docker_user_group

- user:
    name: "{{ ansible_user }}"
    groups: input
- name: Reset connection after docker installation
  meta: reset_connection
  when: docker_user_group.changed

- name: Setup docker
  become: true
  import_role:
    name: geerlingguy.docker
  vars:
    docker_apt_arch: "{{ 'arm64' if (ansible_architecture == 'aarch64') else 'amd64' }}"
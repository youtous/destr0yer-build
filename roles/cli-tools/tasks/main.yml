---
# This playbook contains CLI tools installation, CLI tools are for user not for the system
- name: include default vars
  include_vars: default.yml

- name: install CLI Tools
  apt:
    name: "{{ cli_packages }}"

- name: configure vim
  copy:
    src: files/vimrc.local
    dest: /etc/vim/vimrc.local
    owner: root
    group: root
    mode: u=rw,g=r,o=r

- name: install ruby
  apt:
    name: "{{ ruby_packages }}"

- name: install colorls gem
  gem:
    name: colorls
    state: latest
    install_dir: /usr/local/bin/
    user_install: false

- name: test ccat presence
  command: /usr/local/bin/ccat /dev/null
  register: ccat_present
  ignore_errors: True

- debug:
    msg: "System {{ inventory_hostname }} has arc {{ ansible_architecture }}"

- name: install golang
  import_role:
    name: fubarhouse.golang
  vars:
    go_version: '1.12.4'
    GOROOT: /usr/local/go
    GOARCH: "{{ 'arm64' if (ansible_architecture == 'aarch64') else 'amd64' }}"
    # checksum depending of the arch
    go_checksum: "{{ 'b7d7b4319b2d86a2ed20cef3b47aa23f0c97612b469178deecd021610f6917df' if (ansible_architecture == 'aarch64') else 'd7d1f1f88ddfe55840712dc1747f37a790cbcaa448f6c9cf51bbe10aa65442f5' }}"

- name: install ccat
  shell: |
    cd /root &&
    go get -u github.com/jingweno/ccat &&
    sudo mv go/bin/ccat /usr/local/bin/ &&
    sudo rm -Rf github.com/jingweno/ccat
  when: ccat_present is failed

- name: install python
  apt:
    name: "{{ python_packages }}"

- name: update setuptools
  pip:
    name: setuptools
    state: latest
    extra_args: --upgrade

- name: install mdv (Markdown viewer)
  pip:
    name: mdv
    state: latest
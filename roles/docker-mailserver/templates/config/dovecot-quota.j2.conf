
# enforce quota
mail_plugins = $mail_plugins quota

protocol imap {
    # allow IMAP clients to ask quota usage
    mail_plugins = $mail_plugins imap_quota
}

plugin {
    # debug quota using `doveadm quota get -u user@domain`
    # recompute quota using `doveadm quota recalc -u user@domain`

    # Track the current quota usage in Dovecotâ€™s index files.
    quota = count:User quota

    # Use virtual sizes for count
    quota_vsizes = yes

    # define the maximum message size, todo : sync with postfix
    quota_max_mail_size = 100M

    # default quota per mailbox
    quota_rule = *:storage=512M

    quota_grace = 10%%
    # 10% is the default
    quota_warning = storage=95%% quota-warning 95 %u
    quota_warning2 = storage=80%% quota-warning 80 %u
    quota_warning3 = -storage=100%% quota-warning below %u # user is no longer over quota
    quota_status_overquota = "552 5.2.2 Mailbox is full"
}

service quota-warning {
    # todo : send email to inform quota reached
    executable = script /usr/local/bin/quota-warning.sh
    user = dovecot
    unix_listener quota-warning {
    }
}

# allow postfix to query quota
service quota-status {
    executable = quota-status -p postfix
    inet_listener {
    port = 65265
    # You can choose any port you want
    }
    client_limit = 1
}

# IMPORTANT, KEEP A NEW LINE AT THE END OF THIS FILE.
---
# This role setup a script called by duply before backup. The script will save all databases present in the postgresql

- name: Ensure backup directory is present
  become: True
  file:
    state: directory
    path: "{{ postgresql_backup_output }}"
    owner: postgres
    group: postgres
    mode: u=rwx,g=,o=

- name: Add backup script to Duply pre scripts
  become: True
  template:
    src: "templates/register-backup-script.sh.j2"
    dest: "{{ duply_prescript_folder }}/10-postgresql-all-databases.sh"
    owner: root
    group: root
    mode: u=rwx,g=,o=

- name: Add cleanup script to Duply post scripts
  become: True
  template:
    src: "templates/register-cleanup-backup-script.sh.j2"
    dest: "{{ duply_postscript_folder }}/10-postgresql-all-databases.sh"
    owner: root
    group: root
    mode: u=rwx,g=,o=
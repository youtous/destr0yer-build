---
# This role install or update k9s if needed

- name: Check if k9s is installed
  ansible.builtin.stat:
    path: "{{ k8s_k9s_path }}"
  register: k9s_binary_present

- name: Get k9s installed version
  ansible.builtin.shell: >
    set -o pipefail &&
    {{ k8s_k9s_path }} version | grep "{{ k8s_k9s_version }}" --only-matching
  args:
    executable: /bin/bash
  when: k9s_binary_present.stat.exists
  changed_when: false
  register: k9s_current_version

- name: Install k9s
  when: not k9s_binary_present.stat.exists or (k9s_current_version.stdout != k8s_k9s_version)
  ansible.builtin.import_tasks: install.yml
...

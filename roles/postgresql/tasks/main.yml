---
# This role installs PostgreSQL on the system. It allows connections from database_clients hosts (group).
# setup role from https://github.com/geerlingguy/ansible-role-postgresql
- name: Setup postgresql
  become: yes
  import_role:
    name: geerlingguy.postgresql
  vars:
    postgresql_users: "{{ postgre_users }}"
    postgresql_databases: "{{ postgre_databases }}"
    postgresql_hba_entries: "{{ postgre_hba_entries }}"

- name: Configure logrotate for postgresql
  import_role:
    name: logrotate
  vars:
    logrotate_applications:
      - name: postgresql
        definitions:
          - logs: # log per version, PostgreSQL11
              - "/var/log/postgresql/postgresql-11-main.log"
            options:
              - monthly
              - rotate 12
              - size 10M
              - compress
              - delaycompress
              - missingok
              - notifempty
              - create 0640 postgres admin
...
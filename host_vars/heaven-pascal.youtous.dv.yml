# This file describes specific host vars
hostname: heaven-pascal.youtous.dv
ipv4:
  - 192.168.100.10
ipv6:
  - fde4:8dba:82e1::c1

host_users:
  - username: specu
    name: Specific user on heaven
    groups: ['users', 'sshusers', 'docker']
    uid: 10020
    ssh_key: "{{ specu_ssh_keys }}"
    password: "{{ specu_password }}"
    update_password: "always"

### Begin of relay-smtp parameters ###

# smtp relay parameters
relay_email: monitoring-heaven-pascal@youtous.me
relay_user: "{{ relay_email }}"
relay_password: "{{ secret_relay_password }}"

### End of relay-smtp parameters ###

### Begin of docker Traefik parameters ###

# let's encrypt email for certificates
lets_encrypt_email: "admin+heaven-pascal@youtous.me"
# number of traefik replicas
traefik_replicas: 0
# number of consul replicas => see Consul documentation
consul_replicas: 0

### End of docker Traefik parameters ###

### Begin of database parameters ###

# list of mariadb users
mariadb_users:
  - name: youtous
    host: localhost
    password: "{{ mariadb_user_youtous_passwd }}"
    # Example privileges string format
    # mydb.*:INSERT,UPDATE/anotherdb.*:SELECT/yetanotherdb.*:ALL
    priv: 'youtous.*:ALL/*.*:REQUIRESSL' # requires an SSL connection, not useful in local but useful for externals connections
    state: present # default value
  - name: arb1t3r
    host: "%" # allows connection from any host (filtered later by UFW)
    password: "poney"
    priv: 'arb1t3r.*:ALL'
  - name: nextcloud
    host: "%" # allows connection from any host (filtered later by UFW)
    password: "nextcloud"
    priv: 'nextcloud.*:ALL'

# list of databases
mariadb_databases:
  - name: youtous
  - name: arb1t3r
  - name: nextcloud

### End of database parameters ###

### Begin of Nextcloud parameters ###
nextcloud_db_name: "nextcloud"
nextcloud_db_user: "nextcloud"
nextcloud_db_password: "nextcloud"
nextcloud_db_host: "{{ hostname }}"

# Nextcloud user conf
nextcloud_admin_user: "nextcloud-admin"
nextcloud_admin_password: "set a super secure password !"

# Nextcloud smtp configuration
nextcloud_smtp_host: "localhost"
nextcloud_smtp_secure: "tls"
nextcloud_smtp_port: "587"
nextcloud_smtp_authtype: "LOGIN"
nextcloud_smtp_username: ""
nextcloud_smtp_password: ""
nextcloud_smtp_from: "nextcloud@localhost"
nextcloud_smtp_domain_from: "{{ nextcloud_domain }}"
### End of Nextcloud parameters ###


### Begin of docker elastic parameters ###

# list of nodes (ips) allowed to submit log data
logstash_allowed_ips: "{{ nodes_ips }}" # by default, all nodes are allowed to send logs data, list can be completed
                                        # with external addresses

### End of docker elastic parameters ###

### Begin of dynamic updating parameters ###

# dynamic-ip parameters
update_ip_cloudflare_zone_name: youtous.me
update_ip_cloudflare_record_name: test-dyn-heaven-pascal.youtous.dv

### End of dynamic updating parameters ###


### Begin of Backup storage parameters ###
backup_frozen_directory: "/home/frozen-backups/"
# backup-storage parameters
backup_users:
  - username: heaven-roberval # final username will be prefixed by backup_
    restrict_ips: "{{ hostvars['heaven-roberval.youtous.dv']['ipv4'] + hostvars['heaven-roberval.youtous.dv']['ipv6'] }}"
    # specify host public keys
    ssh_keys:
      - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIH6vcZbXLfRAj2g8RvdU2RRc/EYsMtLZTMEPhvDkAEir root@heaven-roberval.youtous.dv"
  - username: heaven-pascal
    restrict_ips: "{{ hostvars['heaven-pascal.youtous.dv']['ipv4'] + hostvars['heaven-pascal.youtous.dv']['ipv6'] }}"
    # specify host public keys
    ssh_keys:
      - "{{ root_public_key }} root@heaven-pascal.youtous.dv"

### End of Backup storage parameters ###


### Begin of Backup strategy parameters ###

# deploy generated ssh keys for root
users_ssh_keys:
  - username: root
    public_key: "{{ root_public_key }}"
    private_key: "{{ root_private_key }}"

# backup strategy (see role for more details)
global_backup_gpg_public_key:
  name: 8DD9CF31319D84D9 # get the name using `gpg --list-secret-keys --keyid-format LONG`, pick the SUB-KEY (ssb)
  key: "{{ secret_backup_gpg_public_key }}"
# key used for signing backups
global_backup_gpg_private_key:
  name: 05772F3F9FC0EC9A # get the name using `gpg --list-secret-keys --keyid-format LONG`, pick the MASTER KEY (sec)
  key: "{{ secret_backup_gpg_private_key }}"
# to get the ownertrust value, find key fingerprint using gpg PUBLIC_KEY.pub.asc
# then compare with `gpg --export-ownertrust`
global_backup_gpg_ownertrust:
  name: "{{ global_backup_gpg_public_key.name }}.ownertrust.txt"
  value: "20D2F257283B2513213E360005772F3F9FC0EC9A:6:"
# passphrase of the signing and decrypting keys /!\ PLEASE ESCAPE THE PASSPHRASE IF IT CONTAINS ' CHARACTERS
global_backup_gpg_key_passphrase: "{{ secret_backup_gpg_key_passphrase }}"

global_backup_destination: "pexpect+sftp://backup_heaven-pascal@{{ hostvars['heaven-pascal.youtous.dv']['hostname'] }}/home"
# change the cron-job minute
global_backup_jobs:
  - name: duply-backup-global
    job: /usr/bin/duply global backup
    minute: "0"
    hour: "6"
    day: "*"
    month: "*"
    weekday: "*"
# what to keep ?
global_backup_excludes:
  - "+ /home"
  - "+ /var/lib/docker/volumes"
  - "+ /var/lib/docker/swarm"
  - "- **" # only keep home folder and swarm
### End of Backup strategy parameters ###

